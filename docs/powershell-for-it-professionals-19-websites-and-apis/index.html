<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>PowerShell for IT Professionals [#19] – Websites and APIs - Kamil Procyszyn</title><meta name="Description" content=""><meta property="og:title" content="PowerShell for IT Professionals [#19] – Websites and APIs" />
<meta property="og:description" content="PowerShell is a great server automation tool, but what about Internet and any other web served services?
As it turns out, PowerShell is great in scrapping websites and consuming APIs – and it’s been one of the main development areas of the tool in the last couple of years.
In this lesson we are going to see how to use PowerShell to download files, scrap websites, discover links." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://kprocyszyn.github.io/powershell-for-it-professionals-19-websites-and-apis/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-11-15T20:57:20+00:00" />
<meta property="article:modified_time" content="2020-11-15T20:57:20+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="PowerShell for IT Professionals [#19] – Websites and APIs"/>
<meta name="twitter:description" content="PowerShell is a great server automation tool, but what about Internet and any other web served services?
As it turns out, PowerShell is great in scrapping websites and consuming APIs – and it’s been one of the main development areas of the tool in the last couple of years.
In this lesson we are going to see how to use PowerShell to download files, scrap websites, discover links."/>
<meta name="application-name" content="Kamil Procyszyn">
<meta name="apple-mobile-web-app-title" content="Kamil Procyszyn"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://kprocyszyn.github.io/powershell-for-it-professionals-19-websites-and-apis/" /><link rel="prev" href="http://kprocyszyn.github.io/powershell-for-it-professionals-18-working-with-text-strings/" /><link rel="next" href="http://kprocyszyn.github.io/powershell-for-it-professionals-20-next-steps-with-powershell/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "PowerShell for IT Professionals [#19] – Websites and APIs",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/kprocyszyn.github.io\/powershell-for-it-professionals-19-websites-and-apis\/"
        },"genre": "post","keywords": "api, course, download, internet, invoke, json, method, password, powershell, pwpush, request, rest, scrapping, script, training, website","wordcount":  326 ,
        "url": "http:\/\/kprocyszyn.github.io\/powershell-for-it-professionals-19-websites-and-apis\/","datePublished": "2020-11-15T20:57:20+00:00","dateModified": "2020-11-15T20:57:20+00:00","publisher": {
            "@type": "Organization",
            "name": "Kamil"},"author": {
                "@type": "Person",
                "name": "Kamil"
            },"description": ""
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Kamil Procyszyn">Kamil Procyszyn</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Kamil Procyszyn">Kamil Procyszyn</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="page single special"><h1 class="single-title animated pulse faster">PowerShell for IT Professionals [#19] – Websites and APIs</h1><div class="content" id="content">
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/dzaqNeblPF4" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<p>PowerShell is a great server automation tool, but what about Internet and any other web served services?</p>
<p>As it turns out, PowerShell is great in scrapping websites and consuming APIs – and it’s been one of the main development areas of the tool in the last couple of years.</p>
<p>In this lesson we are going to see how to use PowerShell to download files, scrap websites, discover links.</p>
<p>We will then use an API of <a href="https://pwpush.com/" target="_blank" rel="noopener noreffer">PasswordPusher (pwpush.com)</a> to generate expiring links to our secret passwords – all from within PowerShell.</p>
<h2 id="script">Script</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nb">Set-Location</span> <span class="n">C:</span><span class="p">\</span><span class="n">temp2</span><span class="p">;</span> <span class="nb">clear
</span><span class="nb"></span><span class="nv">$PSVersionTable</span>
<span class="c">### Invoke-WebRequest</span>
<span class="c"># Downloading files</span>
<span class="nv">$uri</span> <span class="p">=</span> <span class="s2">&#34;https://github.com/notepad-plus-plus/notepad-plus-plus/releases/download/v7.9.1/npp.7.9.1.Installer.x64.exe&#34;</span>
<span class="nv">$here</span> <span class="p">=</span> <span class="nb">Get-Location</span>

<span class="nb">Invoke-WebRequest</span> <span class="n">-Uri</span> <span class="nv">$uri</span>
<span class="nb">Invoke-WebRequest</span> <span class="n">-Uri</span> <span class="nv">$uri</span> <span class="n">-OutFile</span> <span class="p">.\</span><span class="n">notepad1</span><span class="p">.</span><span class="n">exe</span>
<span class="nb">ls
</span><span class="nb"></span>
<span class="nv">$wc</span> <span class="p">=</span> <span class="p">&amp;</span><span class="c">#91;System.Net.Webclient]::New()</span>
<span class="nv">$wc</span><span class="p">.</span><span class="n">DownloadFile</span><span class="p">(</span><span class="nv">$uri</span><span class="p">,</span> <span class="s2">&#34;$here\notepad2.exe&#34;</span><span class="p">)</span>
<span class="nb">ls
</span><span class="nb"></span>
<span class="nb">Start-BitsTransfer</span> <span class="n">-Source</span> <span class="nv">$uri</span> <span class="n">-Destination</span> <span class="s2">&#34;$here\notepad3.exe&#34;</span>
<span class="nb">ls
</span><span class="nb"></span>
<span class="nv">$Website</span> <span class="p">=</span> <span class="nb">Invoke-WebRequest</span> <span class="n">-Uri</span> <span class="s2">&#34;bbc.com&#34;</span>
<span class="nv">$Website</span>
<span class="nv">$Website</span><span class="p">.</span><span class="n">StatusCode</span><span class="p">;</span> <span class="nv">$Website</span><span class="p">.</span><span class="n">StatusDescription</span><span class="p">;</span> <span class="nv">$Website</span><span class="p">.</span><span class="n">Headers</span>
<span class="nv">$Website</span><span class="p">.</span><span class="n">RawContent</span> 
<span class="nv">$Website</span><span class="p">.</span><span class="n">RawContent</span> <span class="p">|</span> <span class="nb">Out-File</span> <span class="n">website</span><span class="p">.</span><span class="n">html</span>
<span class="n">explorer</span> <span class="p">.</span>
<span class="c"># Websites</span>
<span class="nv">$Website</span><span class="p">.</span><span class="n">Links</span>
<span class="nv">$Website</span><span class="p">.</span><span class="n">Links</span> <span class="p">|</span> <span class="nb">where </span><span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">class</span> <span class="o">-eq</span> <span class="s2">&#34;top-list-item__link&#34;</span><span class="p">}</span>
<span class="nv">$Website</span><span class="p">.</span><span class="n">Links</span> <span class="p">|</span> <span class="nb">where </span><span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">class</span> <span class="o">-eq</span> <span class="s2">&#34;top-list-item__link&#34;</span><span class="p">}</span> <span class="p">|</span> <span class="nb">select data-bbc</span><span class="n">-title</span><span class="p">,</span><span class="n">href</span>

<span class="c"># Resolving shortcut urls</span>
<span class="nv">$Website</span><span class="p">.</span><span class="n">Images</span>
<span class="nv">$Website</span><span class="p">.</span><span class="n">images</span> <span class="p">|</span> <span class="nb">where </span><span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">src</span> <span class="o">-like</span> <span class="s2">&#34;http*&#34;</span><span class="p">}</span>
<span class="nv">$Website</span><span class="p">.</span><span class="n">images</span> <span class="p">|</span> <span class="nb">where </span><span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">src</span> <span class="o">-like</span> <span class="s2">&#34;http*&#34;</span><span class="p">}</span> <span class="p">|</span> <span class="nb">ForEach-Object</span>  <span class="p">{</span><span class="nb">Start-BitsTransfer</span> <span class="n">-Source</span> <span class="nv">$_</span><span class="p">.</span><span class="n">src</span> <span class="n">-Destination</span> <span class="s2">&#34;</span><span class="p">$(</span><span class="nv">$_</span><span class="p">.</span><span class="n">alt</span><span class="p">)</span><span class="s2">.jpg&#34;</span> <span class="p">}</span>
<span class="nb">ls
</span><span class="nb"></span><span class="n">explorer</span> <span class="p">.</span>

<span class="c"># Short urls</span>
<span class="nv">$uri</span> <span class="p">=</span> <span class="s2">&#34;https://bit.ly/38JsRDB&#34;</span>
<span class="nv">$response</span> <span class="p">=</span> <span class="nb">Invoke-WebRequest</span> <span class="n">-Uri</span> <span class="nv">$uri</span>
<span class="nv">$response</span><span class="p">.</span><span class="n">BaseResponse</span><span class="p">.</span><span class="n">RequestMessage</span><span class="p">.</span><span class="n">RequestUri</span><span class="p">.</span><span class="n">AbsoluteUri</span>

<span class="c"># Api</span>
<span class="nv">$Uri</span> <span class="p">=</span> <span class="s2">&#34;https://pwpush.com/p.json&#34;</span>

<span class="c"># Json</span>
<span class="nv">$json</span> <span class="p">=</span> <span class="s1">&#39;{
</span><span class="s1">    &#34;password&#34;: {
</span><span class="s1">      &#34;expire_after_views&#34;: 5,
</span><span class="s1">      &#34;expire_after_days&#34;: 2,
</span><span class="s1">      &#34;payload&#34;: &#34;mysecretpassword&#34;
</span><span class="s1">    }
</span><span class="s1">  }&#39;</span>

<span class="nv">$request</span> <span class="p">=</span> <span class="nb">Invoke-WebRequest</span> <span class="n">-Uri</span> <span class="nv">$uri</span> <span class="n">-Method</span> <span class="s2">&#34;Post&#34;</span> <span class="n">-ContentType</span> <span class="s2">&#34;application/json&#34;</span> <span class="n">-Body</span> <span class="nv">$json</span>
<span class="nv">$request</span>
<span class="nv">$request</span><span class="p">.</span><span class="n">Content</span>
<span class="nv">$request</span><span class="p">.</span><span class="n">Content</span> <span class="p">|</span> <span class="nb">ConvertFrom-Json</span>

<span class="nv">$body</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">password</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="s2">&#34;payload&#34;</span> <span class="p">=</span> <span class="s2">&#34;mysecretpassword&#34;</span>
    <span class="s2">&#34;expire_after_days&#34;</span> <span class="p">=</span> <span class="n">2</span>
    <span class="s2">&#34;expire_after_views&#34;</span> <span class="p">=</span> <span class="n">5</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nv">$body</span>
<span class="nv">$body</span><span class="p">.</span><span class="n">password</span> 
<span class="nv">$Body</span> <span class="p">|</span> <span class="nb">ConvertTo-Json</span>
<span class="nv">$Body</span>

<span class="nv">$body</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">password</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="s2">&#34;payload&#34;</span> <span class="p">=</span> <span class="s2">&#34;mysecretpassword&#34;</span>
    <span class="s2">&#34;expire_after_days&#34;</span> <span class="p">=</span> <span class="n">2</span>
    <span class="s2">&#34;expire_after_views&#34;</span> <span class="p">=</span> <span class="n">5</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="p">|</span> <span class="nb">ConvertTo-Json</span>

<span class="nb">Invoke-WebRequest</span> <span class="n">-Uri</span> <span class="nv">$uri</span> <span class="n">-Method</span> <span class="s2">&#34;Post&#34;</span> <span class="n">-ContentType</span> <span class="s2">&#34;application/json&#34;</span> <span class="n">-Body</span> <span class="nv">$body</span>

<span class="c">###Invoke-RestMethod</span>

<span class="nv">$Uri</span> <span class="p">=</span> <span class="s2">&#34;https://pwpush.com/p.json&#34;</span>
 
<span class="nv">$params</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">uri</span> <span class="p">=</span> <span class="nv">$uri</span>
    <span class="n">ContentType</span> <span class="p">=</span> <span class="s2">&#34;application/json&#34;</span>
    <span class="n">Method</span> <span class="p">=</span> <span class="s2">&#34;Post&#34;</span>
    <span class="n">body</span> <span class="p">=</span> <span class="nv">$body</span>
<span class="p">}</span>
<span class="nv">$password</span> <span class="p">=</span> <span class="nb">Invoke-RestMethod</span> <span class="nv">@params</span>
<span class="nv">$password</span>

<span class="c"># Let&#39;s confirm it worked</span>
<span class="nv">$uri</span> <span class="p">=</span> <span class="s2">&#34;https://pwpush.com/p/{0}.json&#34;</span> <span class="o">-f</span> <span class="nv">$password</span><span class="p">.</span><span class="n">url_token</span>
<span class="nb">Invoke-RestMethod</span> <span class="n">-Uri</span> <span class="nv">$uri</span>
</code></pre></div></div></div></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.91.2">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank"></a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
