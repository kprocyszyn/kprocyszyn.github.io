<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>PowerShell for IT Professionals [#16] – Scripting part 3 – Add-Member and network - Kamil Procyszyn</title><meta name="Description" content=""><meta property="og:title" content="PowerShell for IT Professionals [#16] – Scripting part 3 – Add-Member and network" />
<meta property="og:description" content="In this lesson we are taking our script further by adding details about IP configuration and last installed hotfixes.
But it turns out, the networking information is not that shallow as it seems at the first glance – thus I’ll show you how to retrieve the information from the configuration.
We will also look on how to reuse our already created object so that we don’t need to duplicate code." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://kprocyszyn.github.io/powershell-for-it-professionals-16-scripting-part-3-add-member-and-network/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-13T19:12:40+00:00" />
<meta property="article:modified_time" content="2020-10-13T19:12:40+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="PowerShell for IT Professionals [#16] – Scripting part 3 – Add-Member and network"/>
<meta name="twitter:description" content="In this lesson we are taking our script further by adding details about IP configuration and last installed hotfixes.
But it turns out, the networking information is not that shallow as it seems at the first glance – thus I’ll show you how to retrieve the information from the configuration.
We will also look on how to reuse our already created object so that we don’t need to duplicate code."/>
<meta name="application-name" content="Kamil Procyszyn">
<meta name="apple-mobile-web-app-title" content="Kamil Procyszyn"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://kprocyszyn.github.io/powershell-for-it-professionals-16-scripting-part-3-add-member-and-network/" /><link rel="prev" href="http://kprocyszyn.github.io/powershell-for-it-professionals-15-scripting-part-2-if-and-psobject/" /><link rel="next" href="http://kprocyszyn.github.io/powershell-for-it-professionals-17-scripting-part-4-parameters-running-remotely-and-formatting/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "PowerShell for IT Professionals [#16] – Scripting part 3 – Add-Member and network",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/kprocyszyn.github.io\/powershell-for-it-professionals-16-scripting-part-3-add-member-and-network\/"
        },"genre": "post","keywords": "add-member, course, hotfix, if, ip configuration, network, patch, powershell, psobject, script, video","wordcount":  280 ,
        "url": "http:\/\/kprocyszyn.github.io\/powershell-for-it-professionals-16-scripting-part-3-add-member-and-network\/","datePublished": "2020-10-13T19:12:40+00:00","dateModified": "2020-10-13T19:12:40+00:00","publisher": {
            "@type": "Organization",
            "name": "Kamil"},"author": {
                "@type": "Person",
                "name": "Kamil"
            },"description": ""
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Kamil Procyszyn">Kamil Procyszyn</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Kamil Procyszyn">Kamil Procyszyn</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="page single special"><h1 class="single-title animated pulse faster">PowerShell for IT Professionals [#16] – Scripting part 3 – Add-Member and network</h1><div class="content" id="content">
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/rA8CWs2Of2Y" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<p>In this lesson we are taking our script further by adding details about IP configuration and last installed hotfixes.</p>
<p>But it turns out, the networking information is not that shallow as it seems at the first glance – thus I’ll show you how to retrieve the information from the configuration.</p>
<p>We will also look on how to reuse our already created object so that we don’t need to duplicate code.</p>
<p>And finally, we will use Add-Member to add more properties to the custom object.</p>
<h2 id="script">Script</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="nv">$OS</span> <span class="p">=</span> <span class="nb">Get-CimInstance</span> <span class="n">-ClassName</span> <span class="n">Win32_OperatingSystem</span>
<span class="c"># OS Name</span>
<span class="nb">Write-Host</span> <span class="s2">&#34;OS Name: </span><span class="p">$(</span><span class="nv">$OS</span><span class="p">.</span><span class="n">Caption</span><span class="p">)</span><span class="s2">&#34;</span>
<span class="c"># Version</span>
<span class="nb">Write-Host</span> <span class="s2">&#34;OS Version: </span><span class="p">$(</span><span class="nv">$OS</span><span class="p">.</span><span class="n">Version</span><span class="p">)</span><span class="s2">&#34;</span>
<span class="c"># Install Date</span>
<span class="nb">Write-Host</span> <span class="s2">&#34;OS Install date: </span><span class="p">$(</span><span class="nv">$OS</span><span class="p">.</span><span class="n">InstallDate</span><span class="p">)</span><span class="s2">&#34;</span>
<span class="c"># Client/Server</span>
<span class="k">IF</span> <span class="p">(</span><span class="nv">$os</span><span class="p">.</span><span class="n">Caption</span> <span class="o">-like</span> <span class="s2">&#34;*Server*&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$server</span> <span class="p">=</span> <span class="nv">$true</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="nv">$server</span> <span class="p">=</span> <span class="nv">$false</span><span class="p">}</span>
<span class="c"># IP: Interface, ip, gateway, dns</span>
<span class="nv">$Network</span> <span class="p">=</span> <span class="nb">Get-NetAdapter</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">Status</span> <span class="o">-eq</span> <span class="s1">&#39;Up&#39;</span><span class="p">}</span> <span class="p">|</span> <span class="nb">Get-NetIPConfiguration</span>
<span class="c"># Last updates</span>
<span class="nv">$Updates</span> <span class="p">=</span> <span class="nb">Get-HotFix</span> <span class="p">|</span> <span class="nb">Sort </span><span class="n">InstalledOn</span> <span class="n">-Descending</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">-First</span> <span class="n">5</span>
<span class="c"># It would be nice if could run this remotely </span>

<span class="nv">$props</span> <span class="p">=</span> <span class="no">[pscustomobject]</span><span class="p">@{</span>
    <span class="s1">&#39;OSName&#39;</span> <span class="p">=</span> <span class="nv">$OS</span><span class="p">.</span><span class="n">Caption</span>
    <span class="s1">&#39;OSVersion&#39;</span> <span class="p">=</span> <span class="nv">$OS</span><span class="p">.</span><span class="n">Version</span>
    <span class="s1">&#39;OSInstallDate&#39;</span> <span class="p">=</span> <span class="nv">$OS</span><span class="p">.</span><span class="n">InstallDate</span>
    <span class="s1">&#39;isServer&#39;</span> <span class="p">=</span> <span class="nv">$Server</span>
    <span class="s1">&#39;IPv4Address&#39;</span> <span class="p">=</span> <span class="nv">$Network</span><span class="p">.</span><span class="n">IPv4Address</span><span class="p">.</span><span class="n">IPAddress</span>
    <span class="s1">&#39;Gateway&#39;</span> <span class="p">=</span> <span class="nv">$Network</span><span class="p">.</span><span class="n">IPv4DefaultGateway</span><span class="p">.</span><span class="n">nexthop</span>
    <span class="s1">&#39;DNS&#39;</span> <span class="p">=</span> <span class="nv">$Network</span><span class="p">.</span><span class="n">DNSServer</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">AddressFamily</span> <span class="o">-eq</span> <span class="s1">&#39;2&#39;</span><span class="p">}</span> <span class="p">|</span> <span class="nb">Select-Object</span> <span class="n">ServerADdresses</span> <span class="n">-ExpandProperty</span> <span class="n">ServerAddresses</span>
    <span class="s1">&#39;Updates&#39;</span> <span class="p">=</span> <span class="nv">$Updates</span><span class="p">.</span><span class="n">HotfixID</span> <span class="p">|</span> <span class="nb">Out-String</span>
<span class="p">}</span>
<span class="c"># Network: Can I ping gateway, DNS Server, website</span>
<span class="nv">$pingGateway</span> <span class="p">=</span> <span class="nb">Test-NetConnection</span> <span class="n">-ComputerName</span> <span class="nv">$props</span><span class="p">.</span><span class="n">Gateway</span> <span class="n">-InformationLevel</span> <span class="n">Quiet</span>
<span class="nv">$pingDNS</span> <span class="p">=</span> <span class="nb">Test-NetConnection</span> <span class="n">-ComputerName</span> <span class="nv">$props</span><span class="p">.</span><span class="n">DNS</span><span class="p">&amp;</span><span class="c">#91;0] -InformationLevel Quiet</span>
<span class="nv">$pingWebsite</span> <span class="p">=</span> <span class="nb">Test-NetConnection</span> <span class="n">-ComputerName</span> <span class="s1">&#39;kamilpro.com&#39;</span> <span class="n">-InformationLevel</span> <span class="n">Quiet</span>

<span class="nv">$props</span> <span class="p">|</span> <span class="nb">Add-Member</span> <span class="n">-MemberType</span> <span class="n">NoteProperty</span> <span class="n">-Value</span> <span class="nv">$pingGateway</span> <span class="n">-Name</span> <span class="s1">&#39;pingGateway&#39;</span>
<span class="nv">$props</span> <span class="p">|</span> <span class="nb">Add-Member</span> <span class="n">-MemberType</span> <span class="n">NoteProperty</span> <span class="n">-Value</span> <span class="nv">$pingDNS</span> <span class="n">-Name</span> <span class="s1">&#39;pingDNS&#39;</span>
<span class="nv">$props</span> <span class="p">|</span> <span class="nb">Add-Member</span> <span class="n">-MemberType</span> <span class="n">NoteProperty</span> <span class="n">-Value</span> <span class="nv">$pingWebsite</span> <span class="n">-Name</span> <span class="s1">&#39;pingWebsite&#39;</span>
<span class="c"># Installed roles – server only</span>

<span class="k">IF</span> <span class="p">(</span><span class="nv">$props</span><span class="p">.</span><span class="n">isServer</span> <span class="p">=</span> <span class="nv">$true</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$Roles</span> <span class="p">=</span> <span class="nb">Get-WindowsFeature</span> <span class="p">}</span>

<span class="nv">$props</span>
</code></pre></div></div></div></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.91.2">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank"></a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
